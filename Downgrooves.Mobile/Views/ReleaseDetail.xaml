<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:Downgrooves.Mobile.ViewModels.Releases"
             xmlns:ff="clr-namespace:FFImageLoading.Forms;assembly=FFImageLoading.Forms"
             xmlns:ffsvg="clr-namespace:FFImageLoading.Svg.Forms;assembly=FFImageLoading.Svg.Forms"
             xmlns:fft="clr-namespace:FFImageLoading.Transformations;assembly=FFImageLoading.Transformations"
             xmlns:models="clr-namespace:Downgrooves.Mobile.Models"
             x:Class="Downgrooves.Mobile.Views.ReleaseDetail"
             Title="{Binding Release.Title}" x:DataType="viewModels:ReleaseDetailViewModel">
    <ContentPage.Content>
        <StackLayout>
            <Frame BackgroundColor="{DynamicResource ButtonBackgroundColor}" Margin="1" Padding="3">
                <ff:CachedImage Source="{Binding Release.ArtworkUrl}" Aspect="AspectFill" />
            </Frame>
            <Label Text="{Binding Release.ArtistName}" Style="{DynamicResource h3}" HorizontalOptions="CenterAndExpand" FontAttributes="Bold" />
            <Label Text="{Binding Release.Title}" Style="{DynamicResource h3}" HorizontalOptions="CenterAndExpand" />
            <Button Text="{Binding Release.Price, StringFormat='Buy on iTunes ${0}'}"
                    Command="{Binding OpenLinkCommand, Source={RelativeSource AncestorType={x:Type viewModels:ReleaseDetailViewModel}}}"
                    CommandParameter="{Binding Release.BuyUrl}"
                    Style="{DynamicResource BuyButton}" Margin="10" />
            <StackLayout Orientation="Horizontal" Margin="10,0">
                <Label Text="Preview" HorizontalOptions="StartAndExpand" />
                <Label Text="Buy" HorizontalOptions="EndAndExpand" />
            </StackLayout>
            <BoxView Style="{DynamicResource Separator}" />
            <CollectionView ItemsSource="{Binding Release.Tracks}">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="models:ReleaseTrack">
                        <StackLayout>
                            <StackLayout Orientation="Horizontal" Padding="10">
                                <ffsvg:SvgCachedImage Source="{Binding PreviewIcon, Source={RelativeSource AncestorType={x:Type viewModels:ReleaseDetailViewModel}}}" Margin="0,0,10,0" WidthRequest="15" HeightRequest="15">
                                    <ffsvg:SvgCachedImage.Transformations>
                                        <fft:TintTransformation HexColor="#FFFFFFFF" EnableSolidColor="true" />
                                    </ffsvg:SvgCachedImage.Transformations>
                                </ffsvg:SvgCachedImage>
                                <Label Text="{Binding Title}"  HorizontalOptions="StartAndExpand" VerticalOptions="CenterAndExpand" />
                                <StackLayout Orientation="Horizontal" HorizontalOptions="End">
                                    <Button Text="{Binding Price, StringFormat='${0}'}"
                                            Command="{Binding OpenLinkCommand, Source={RelativeSource AncestorType={x:Type viewModels:ReleaseDetailViewModel}}}"
                                            CommandParameter="{Binding BuyUrl, Source={RelativeSource AncestorType={x:Type viewModels:ReleaseDetailViewModel}}}"
                                            Style="{DynamicResource SmallBuyButton}" HeightRequest="25" WidthRequest="60" />
                                </StackLayout>
                            </StackLayout>
                            <BoxView Style="{DynamicResource Separator}" />
                        </StackLayout>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </StackLayout>
    </ContentPage.Content>
</ContentPage>